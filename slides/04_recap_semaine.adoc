
[.text-is-centered]
== Semaine 1
image::images/semaine1.png[width=80%]

[%notitle.columns.is-vcentered]
=== Semaine 1
image::images/recap_semaine.png[background, size=contain]

[%notitle.columns.is-vcentered]
=== pg_stat_statements

[.column.is-one-fifth]
image::images/terminal.png[width=50%]

.pg_stat_statements
[.column.terminal]
****
[source, bash, highlight=1..2|3]
----
- Ajout dans le fichier postgresql.conf :
shared_preload_libraries = 'pg_stat_statements'
- Redémarrage de PostgreSQL
----

[source, sql, highlight=1|2]
----
create extension pg_stat_statements;
select pg_stat_statements_reset();
----
****

[.notes]
--
* équivalent oracle : v$sqlstats
--


[%notitle]
=== Projections fermées

.Projections fermées
****
[source, java]
----
interface CourrierReporting {
	String getVille();
	String getDestinataire();
}
----
****

[%notitle]
=== Projections ouvertes

.Projections ouvertes
****
[source, java]
----
interface CourrierReporting {
	String getVille();
	String getDestinataire();

	default String getFullDestinataire() {
		return getDestinataire().concat(" ").concat(getVille());
	}
}
----
****

[%notitle]
=== Stream

.Récupérer une liste de courriers
****
[source, java, highlight=1..2;5|1;3;5|1;4;5]
----
public interface CourrierRepository extends JpaRepository<Courrier, Long> {
	Stream<Courrier> getByVille(String ville);
	Slice<Courrier> getByVille(String ville, Pageable p);
	Page<Courrier> getByVille(String ville, Pageable p);
}
----
****

[.text-is-centered]
=== Semaine 2
image::images/semaine2.png[width=80%]

[.notes]
--
> Parsing données :

* Phase 1 : explication heap dump avec memory analyser + demo sur les métadonnées (xmx 3Go)

* Phase 2:
* On lance le programme avec les commandes de JFR : `-XX:StartFlightRecording=duration=200s,filename=flight.jfr`
* On lance JMC et on importe le fichier dedans -> permet d'analyser les classes les plus instanciées -> stacktrace (On voit la prédominance de `SimpleDateFormat` et du java.util.Date)
* Optimisation du code et relance pour comparer
--

[%notitle.columns.is-vcentered]
=== Semaine 2
image::images/recap_semaine.png[background, size=contain]

[%notitle.columns.is-vcentered]
=== Semaine 2
.Générer un dump mémoire
[.column]
****
[source, bash]
----
jmap -dump:[live],format=b,file=<file-path> <pid>

jcmd <pid> GC.heap_dump <file-path>

java -XX:+HeapDumpOnOutOfMemoryError #optionel : -Xmx1g
----
****

[%notitle.columns.is-vcentered]
=== Semaine 2
[.column]
Les listes, c'est bien...
[.column]
image::images/leonardo.png[size=contain]

[%notitle.columns.is-vcentered]
=== Semaine 2
[.column]
image::images/tom.png[size=contain]
[.column]
...les stream, c'est mieux ! (enfin, parfois)

[%notitle.columns.is-vcentered]
=== Semaine 2
.Lancer JFR
[.column]
****
[source, bash]
----
java -XX:StartFlightRecording=duration=200s
----
****

[.notes]
--
* Liste = simple, connu, attention au collector et aux très grandes collections
* Stream = rapide (multithread mais attention à la ram), pratique (filtres, etc)
* À ne "consommer" qu'à bon escient !
--

[.text-is-centered]
=== Semaine 3
image::images/semaine3.png[width=80%]

[%notitle.columns.is-vcentered]
=== Semaine 3
image::images/recap_semaine.png[background, size=contain]


=== Livraison
image::images/fin.png[width=100%]